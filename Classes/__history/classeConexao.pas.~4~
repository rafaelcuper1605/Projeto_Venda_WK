unit classeConexao;

interface

uses
   IniFiles, SysUtils, Forms, SqlExpr, Dialogs;

type
  TConexao = class
    private
       private
        Path: string;
        Secao: string;
        Host: string;
        Porta: integer;
        Database: string;
        Password: string;
        User: string;
        VendorLib: string;
        LibraryC: string;
        GetDriver: string;
        Driver: string;
        Connection: string;
        Charset: string;

    public
      constructor Create(Path: string; Secao: string);
      procedure LerArqini(); virtual;
      procedure GravarArqini(Usuario, Senha, Servidor, Banco: string); virtual;
      procedure Conectar(var Conexao: TSQLConnection); virtual;
      property Servidor: string read Host;
      property Usuario: string read User;
      property Senha: string read Password;
      property Banco: string read Database;
  end;

implementation

constructor TConexao.Create(Path: string; Secao: string);
begin

 if FileExists(Path) then
 begin
   Self.Path := Path;
   Self.Secao := Secao;
 end
 else
   raise Exception.Create('Arquivo INI para configuração não encontrado.'#13#10'Aplicação será finalizada.');

 end;

procedure TConexao.Conectar(var Conexao: TSQLConnection);
 begin

    LerArqini();

    try
     Conexao.Connected := false;
     Conexao.LoginPrompt := false;
     Conexao.DriverName := Driver;
     Conexao.GetDriverFunc := GetDriver;
     Conexao.LibraryName := LibraryC;
     Conexao.VendorLib := VendorLib;
     Conexao.Params.Clear;
     Conexao.Params.Add('hostname='+ Host);
     Conexao.Params.Add('user_name='+ User);
     Conexao.Params.Add('password='+ Password);
     Conexao.Params.Add('port='+ IntToStr(Porta));
     Conexao.Params.Add('Database='+ Database);
    Except
     on E:Exception do
      ShowMessage('Erro ao carregar parâmetros de conexão!'#13#10 + E.Message);
    end;
 end;

 procedure TConexao.LerArqini();
 var
   ArqIni : TIniFile;
 begin
    ArqIni := TIniFile.Create(Path);
    try
     Host    := ArqIni.ReadString(Secao, 'Hostname', '');
     Porta    := ArqIni.ReadInteger(Secao, 'Port', 0);
     Database  := ArqIni.ReadString(Secao, 'Database', '');
     Password  := ArqIni.ReadString(Secao, 'Password', '');
     User    := ArqIni.ReadString(Secao, 'user_name', '');
     VendorLib  := ArqIni.ReadString(Secao, 'VendorLib', '');
     LibraryC  := ArqIni.ReadString(Secao, 'LibraryName', '');
     GetDriver  := ArqIni.ReadString(Secao, 'GetDriveFunc', '');
     Driver   := ArqIni.ReadString(Secao, 'drivername', '');
     Charset   := ArqIni.ReadString(Secao, 'charset', '');
     Connection := ArqIni.ReadString(Secao, 'ConnectionName', '');
    finally
      ArqIni.Free;
    end;
 end;

end.
